<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SBA Portal | Reset Access</title>
    <link rel="stylesheet" href="style.css">
</head>
<body style="background: #f1f5f9;">
    <div class="gov-banner">
        <img src="https://upload.wikimedia.org/wikipedia/en/thumb/a/a4/Flag_of_the_United_States.svg/20px-Flag_of_the_United_States.svg.png" style="width:16px; margin-right:8px;" alt="USA Flag">
        OFFICIAL U.S. GOVERNMENT SYSTEM - SECURE 2026
    </div>

    <div class="container">
        <div class="card" style="margin-top: 50px; border-radius: 12px; box-shadow: 0 10px 25px -5px rgba(0,0,0,0.1);">
            <div style="text-align: center; margin-bottom: 20px;">
                <h2 style="color: #1e3a8a; font-size: 22px; margin-bottom: 8px;">Account Recovery</h2>
                <div style="width: 50px; height: 3px; background: #1e3a8a; margin: 0 auto;"></div>
            </div>
            
            <p style="font-size: 13px; color: #64748b; margin-bottom: 25px; line-height: 1.5; text-align: center;">
                Enter your registered email address below. We will send you a secure link to reset your portal access credentials.
            </p>
            
            <label style="display:block; font-size:12px; font-weight:bold; color:#1e293b; margin-bottom:8px;">Registered Email Address</label>
            <input type="email" id="re" placeholder="name@example.com" style="width:100%; padding:14px; border-radius:8px; border:1px solid #cbd5e1; margin-bottom:20px; box-sizing:border-box;">

            <button id="resetBtn" style="background: #1e3a8a; color: white; padding: 16px; border-radius: 10px; width: 100%; font-weight: 800; border: none; cursor: pointer; text-transform: uppercase; letter-spacing: 1px;">
                Send Recovery Link
            </button>

            <div style="text-align:center; margin-top:25px; font-size: 13px;">
                Remembered your password? <a href="index.html" style="color: #1e3a8a; font-weight: bold; text-decoration: none;">Back to Login</a>
            </div>
        </div>

        <div style="text-align: center; margin-top: 30px; padding: 0 20px;">
            <p style="font-size: 10px; color: #94a3b8; line-height: 1.6;">
                <b>Notice:</b> Reset links expire after 60 minutes for security purposes. If you no longer have access to this email, please contact the SBA IT Service Desk for manual identity verification.
            </p>
        </div>
    </div>

    <script type="module" src="script.js"></script>
    <script type="module">
        import { sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";

        const handleReset = async () => {
            const email = document.getElementById('re').value.trim();
            const btn = document.getElementById('resetBtn');

            if (!email) {
                alert("Please enter your email address.");
                return;
            }

            btn.innerText = "VERIFYING ENROLLMENT...";
            btn.disabled = true;

            try {
                // Ensure auth is loaded from script.js
                if (!window.auth) {
                    await new Promise(res => {
                        const check = setInterval(() => {
                            if (window.auth) { clearInterval(check); res(); }
                        }, 100);
                    });
                }

                await sendPasswordResetEmail(window.auth, email);
                
                alert("SECURE LINK DISPATCHED: Please check your inbox and spam folder for instructions.");
                window.location.href = 'index.html';

            } catch (err) {
                let msg = "The system is currently undergoing maintenance. Please try again later.";
                
                if (err.code === 'auth/user-not-found') {
                    msg = "IDENTITY NOT FOUND: No account is registered with this email address.";
                } else if (err.code === 'auth/invalid-email') {
                    msg = "FORMAT ERROR: Please enter a valid email address.";
                } else if (err.code === 'auth/too-many-requests') {
                    msg = "SECURITY BLOCK: Too many attempts. Try again later.";
                }
                
                alert("RECOVERY ERROR: " + msg);
                btn.innerText = "Send Recovery Link";
                btn.disabled = false;
            }
        };

        // Connect button to the function
        document.getElementById('resetBtn').addEventListener('click', handleReset);
    </script>
</body>
</html>
